import React, { useState } from 'react';
import { Calendar, ChefHat, ShoppingCart, Star, Plus, Search, Heart, Clock, Book, TrendingUp, Trash2, Check, X } from 'lucide-react';

const MealPlannerApp = () => {
  const [activeTab, setActiveTab] = useState('planner');
  const [selectedDay, setSelectedDay] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterCuisine, setFilterCuisine] = useState('all');
  const [filterSpiceLevel, setFilterSpiceLevel] = useState('all');
  const [showFavoritesOnly, setShowFavoritesOnly] = useState(false);
  const [newStoreItem, setNewStoreItem] = useState('');

  const [weekPlan, setWeekPlan] = useState({
    Monday: { recipe: null },
    Tuesday: { recipe: { id: 1, name: 'Spaghetti Carbonara', cuisine: 'Italian', spiceLevel: 'none', rating: 4.5, ingredients: ['Pasta', 'Eggs', 'Bacon', 'Parmesan', 'Black Pepper'] } },
    Wednesday: { recipe: null },
    Thursday: { recipe: { id: 3, name: 'Chicken Curry', cuisine: 'Indian', spiceLevel: 'medium', rating: 5, ingredients: ['Chicken', 'Curry Powder', 'Coconut Milk', 'Onions', 'Garlic', 'Ginger', 'Rice'] } },
    Friday: { recipe: null },
    Saturday: { recipe: null },
    Sunday: { recipe: { id: 5, name: 'Roast Chicken', cuisine: 'Comfort', spiceLevel: 'none', rating: 4, ingredients: ['Whole Chicken', 'Potatoes', 'Carrots', 'Onions', 'Herbs', 'Olive Oil'] } }
  });

  const [recipes, setRecipes] = useState([
    {
      id: 1,
      name: 'Spaghetti Carbonara',
      cuisine: 'Italian',
      spiceLevel: 'none',
      difficulty: 'medium',
      rating: 4.5,
      timesCooked: 12,
      favorite: true,
      lastCooked: '2025-01-03',
      ingredients: ['Pasta', 'Eggs', 'Bacon', 'Parmesan', 'Black Pepper'],
      notes: 'Do not add cream! Traditional recipe uses egg and pasta water.'
    },
    {
      id: 2,
      name: 'Tacos',
      cuisine: 'Mexican',
      spiceLevel: 'mild',
      difficulty: 'easy',
      rating: 4.8,
      timesCooked: 15,
      favorite: true,
      lastCooked: '2024-12-28',
      ingredients: ['Ground Beef', 'Taco Shells', 'Lettuce', 'Cheese', 'Salsa', 'Sour Cream'],
      notes: 'Keep spices separate so kids can have mild version.'
    },
    {
      id: 3,
      name: 'Chicken Curry',
      cuisine: 'Indian',
      spiceLevel: 'medium',
      difficulty: 'medium',
      rating: 5,
      timesCooked: 8,
      favorite: true,
      lastCooked: '2025-01-01',
      ingredients: ['Chicken', 'Curry Powder', 'Coconut Milk', 'Onions', 'Garlic', 'Ginger', 'Rice'],
      notes: 'Make base mild, add chili for adults at the table.'
    },
    {
      id: 4,
      name: 'Caesar Salad',
      cuisine: 'American',
      spiceLevel: 'none',
      difficulty: 'easy',
      rating: 4,
      timesCooked: 5,
      favorite: false,
      lastCooked: '2024-12-15',
      ingredients: ['Romaine Lettuce', 'Croutons', 'Parmesan', 'Caesar Dressing', 'Chicken Breast'],
      notes: 'Add grilled chicken for protein.'
    },
    {
      id: 5,
      name: 'Roast Chicken',
      cuisine: 'Comfort',
      spiceLevel: 'none',
      difficulty: 'medium',
      rating: 4,
      timesCooked: 20,
      favorite: true,
      lastCooked: '2024-12-20',
      ingredients: ['Whole Chicken', 'Potatoes', 'Carrots', 'Onions', 'Herbs', 'Olive Oil'],
      notes: 'Leftovers great for sandwiches next day.'
    },
    {
      id: 6,
      name: 'Pad Thai',
      cuisine: 'Thai',
      spiceLevel: 'mild',
      difficulty: 'hard',
      rating: 4.2,
      timesCooked: 3,
      favorite: false,
      lastCooked: '2024-11-30',
      ingredients: ['Rice Noodles', 'Shrimp', 'Eggs', 'Peanuts', 'Bean Sprouts', 'Tamarind Paste'],
      notes: 'Keep chili flakes on side.'
    }
  ]);

  const [storeCupboard, setStoreCupboard] = useState([
    'Pasta', 'Rice', 'Olive Oil', 'Garlic', 'Onions', 'Canned Tomatoes', 'Black Pepper', 'Salt', 'Flour', 'Sugar'
  ]);

  const profiles = [
    { name: 'Alex', spiceTolerance: 'high', color: '#3b82f6' },
    { name: 'Sam', spiceTolerance: 'medium', color: '#10b981' },
    { name: 'Jordan', spiceTolerance: 'low', color: '#f59e0b' },
    { name: 'Riley', spiceTolerance: 'none', color: '#ef4444' }
  ];

  const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
  const cuisines = ['all', 'Italian', 'Mexican', 'Indian', 'American', 'Thai', 'Comfort'];
  const spiceLevels = ['all', 'none', 'mild', 'medium', 'hot'];

  const assignMealToDay = (day, recipe) => {
    setWeekPlan(prev => ({
      ...prev,
      [day]: { recipe }
    }));
    setSelectedDay(null);
  };

  const removeMealFromDay = (day) => {
    setWeekPlan(prev => ({
      ...prev,
      [day]: { recipe: null }
    }));
  };

  const toggleFavorite = (recipeId) => {
    setRecipes(prev => prev.map(r => 
      r.id === recipeId ? { ...r, favorite: !r.favorite } : r
    ));
  };

  const filteredRecipes = recipes.filter(recipe => {
    const matchesSearch = recipe.name.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesCuisine = filterCuisine === 'all' || recipe.cuisine === filterCuisine;
    const matchesSpice = filterSpiceLevel === 'all' || recipe.spiceLevel === filterSpiceLevel;
    const matchesFavorite = !showFavoritesOnly || recipe.favorite;
    return matchesSearch && matchesCuisine && matchesSpice && matchesFavorite;
  });

  const getSpiceColor = (level) => {
    switch(level) {
      case 'none': return 'bg-green-100 text-green-800';
      case 'mild': return 'bg-yellow-100 text-yellow-800';
      case 'medium': return 'bg-orange-100 text-orange-800';
      case 'hot': return 'bg-red-100 text-red-800';
      default: return 'bg-gray-100 text-gray-800';
    }
  };

  const addStoreCupboardItem = () => {
    if (newStoreItem.trim() && !storeCupboard.includes(newStoreItem.trim())) {
      setStoreCupboard(prev => [...prev, newStoreItem.trim()]);
      setNewStoreItem('');
    }
  };

  const removeStoreCupboardItem = (item) => {
    setStoreCupboard(prev => prev.filter(i => i !== item));
  };

  const generateShoppingList = () => {
    const allIngredients = [];
    Object.values(weekPlan).forEach(day => {
      if (day.recipe && day.recipe.ingredients) {
        day.recipe.ingredients.forEach(ing => {
          if (!storeCupboard.some(item => item.toLowerCase() === ing.toLowerCase())) {
            allIngredients.push(ing);
          }
        });
      }
    });
    return [...new Set(allIngredients)];
  };

  const getMostCookedMeals = () => {
    return [...recipes].sort((a, b) => b.timesCooked - a.timesCooked).slice(0, 5);
  };

  const getTopRatedMeals = () => {
    return [...recipes].filter(r => r.rating > 0).sort((a, b) => b.rating - a.rating).slice(0, 5);
  };

  const getRecipesUsingStoreCupboard = () => {
    return recipes.filter(recipe => 
      recipe.ingredients.some(ing => 
        storeCupboard.some(item => 
          item.toLowerCase() === ing.toLowerCase()
        )
      )
    ).sort((a, b) => {
      const aMatches = a.ingredients.filter(ing => 
        storeCupboard.some(item => item.toLowerCase() === ing.toLowerCase())
      ).length;
      const bMatches = b.ingredients.filter(ing => 
        storeCupboard.some(item => item.toLowerCase() === ing.toLowerCase())
      ).length;
      return bMatches - aMatches;
    });
  };

  return (
    <div className="min-h-screen bg-gray-50">
      <header className="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div className="max-w-7xl mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <ChefHat className="w-8 h-8 text-blue-600" />
              <h1 className="text-2xl font-bold text-gray-900">Family Meal Planner</h1>
            </div>
            <div className="flex items-center gap-2">
              {profiles.map((profile, idx) => (
                <div key={idx} className="flex items-center gap-1 px-2 py-1 rounded-full bg-gray-100 text-sm">
                  <div className="w-2 h-2 rounded-full" style={{ backgroundColor: profile.color }}></div>
                  <span>{profile.name}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      </header>

      <nav className="bg-white border-b border-gray-200">
        <div className="max-w-7xl mx-auto px-4">
          <div className="flex gap-1">
            {[
              { id: 'planner', label: 'Weekly Planner', icon: Calendar },
              { id: 'recipes', label: 'Recipes', icon: Book },
              { id: 'cupboard', label: 'Store Cupboard', icon: ShoppingCart },
              { id: 'analytics', label: 'Analytics', icon: TrendingUp }
            ].map(tab => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${
                  activeTab === tab.id
                    ? 'border-blue-600 text-blue-600'
                    : 'border-transparent text-gray-600 hover:text-gray-900'
                }`}
              >
                <tab.icon className="w-4 h-4" />
                <span className="font-medium">{tab.label}</span>
              </button>
            ))}
          </div>
        </div>
      </nav>

      <main className="max-w-7xl mx-auto px-4 py-6">
        {activeTab === 'planner' && (
          <div>
            <div className="mb-6">
              <h2 className="text-2xl font-bold text-gray-900 mb-2">This Week&apos;s Meals</h2>
              <p className="text-gray-600">Plan your dinners for the week ahead</p>
            </div>

            <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
              {days.map(day => {
                const meal = weekPlan[day];
                return (
                  <div key={day} className="bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow">
                    <div className="flex items-center justify-between mb-3">
                      <h3 className="font-semibold text-lg text-gray-900">{day}</h3>
                      {meal.recipe && (
                        <button
                          onClick={() => removeMealFromDay(day)}
                          className="text-gray-400 hover:text-red-600 transition-colors"
                        >
                          <Trash2 className="w-4 h-4" />
                        </button>
                      )}
                    </div>

                    {meal.recipe ? (
                      <div>
                        <div className="flex items-start justify-between mb-2">
                          <h4 className="font-medium text-gray-900">{meal.recipe.name}</h4>
                          {recipes.find(r => r.id === meal.recipe.id)?.favorite && (
                            <Heart className="w-4 h-4 text-red-500 fill-current" />
                          )}
                        </div>
                        <div className="flex gap-2 mb-2">
                          <span className="text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-800">
                            {meal.recipe.cuisine}
                          </span>
                          <span className={`text-xs px-2 py-1 rounded-full ${getSpiceColor(meal.recipe.spiceLevel)}`}>
                            {meal.recipe.spiceLevel}
                          </span>
                        </div>
                        <div className="flex items-center gap-1 text-sm text-gray-600">
                          <Star className="w-4 h-4 text-yellow-500 fill-current" />
                          <span>{meal.recipe.rating}</span>
                        </div>
                      </div>
                    ) : (
                      <button
                        onClick={() => setSelectedDay(day)}
                        className="w-full py-8 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors flex flex-col items-center justify-center gap-2 text-gray-500 hover:text-blue-600"
                      >
                        <Plus className="w-6 h-6" />
                        <span className="text-sm font-medium">Add Meal</span>
                      </button>
                    )}
                  </div>
                );
              })}
            </div>

            <div className="mt-8 bg-white rounded-lg border border-gray-200 p-6">
              <h3 className="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                <ShoppingCart className="w-5 h-5" />
                Shopping List
              </h3>
              <div className="grid md:grid-cols-3 gap-3">
                {generateShoppingList().length > 0 ? (
                  generateShoppingList().map((item, idx) => (
                    <div key={idx} className="flex items-center gap-2 p-2 bg-gray-50 rounded">
                      <Check className="w-4 h-4 text-green-600" />
                      <span className="text-gray-700">{item}</span>
                    </div>
                  ))
                ) : (
                  <p className="text-gray-500 col-span-3">No items needed - you have everything!</p>
                )}
              </div>
            </div>
          </div>
        )}

        {activeTab === 'recipes' && (
          <div>
            <div className="mb-6">
              <h2 className="text-2xl font-bold text-gray-900 mb-4">Recipe Collection</h2>
              
              <div className="bg-white rounded-lg border border-gray-200 p-4 mb-4">
                <div className="grid md:grid-cols-4 gap-4">
                  <div className="md:col-span-4">
                    <div className="relative">
                      <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
                      <input
                        type="text"
                        placeholder="Search recipes..."
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                        className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      />
                    </div>
                  </div>
                  <select
                    value={filterCuisine}
                    onChange={(e) => setFilterCuisine(e.target.value)}
                    className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  >
                    {cuisines.map(c => (
                      <option key={c} value={c}>{c === 'all' ? 'All Cuisines' : c}</option>
                    ))}
                  </select>
                  <select
                    value={filterSpiceLevel}
                    onChange={(e) => setFilterSpiceLevel(e.target.value)}
                    className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  >
                    {spiceLevels.map(s => (
                      <option key={s} value={s}>{s === 'all' ? 'All Spice Levels' : s}</option>
                    ))}
                  </select>
                  <button
                    onClick={() => setShowFavoritesOnly(!showFavoritesOnly)}
                    className={`px-4 py-2 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 ${
                      showFavoritesOnly
                        ? 'bg-red-100 text-red-700 border border-red-300'
                        : 'bg-gray-100 text-gray-700 border border-gray-300'
                    }`}
                  >
                    <Heart className={`w-4 h-4 ${showFavoritesOnly ? 'fill-current' : ''}`} />
                    Favorites
                  </button>
                </div>
              </div>

              {selectedDay && (
                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                  <div className="flex items-center justify-between">
                    <p className="text-blue-900 font-medium">
                      Select a recipe to add to {selectedDay}
                    </p>
                    <button
                      onClick={() => setSelectedDay(null)}
                      className="text-blue-600 hover:text-blue-800"
                    >
                      <X className="w-5 h-5" />
                    </button>
                  </div>
                </div>
              )}

              <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                {filteredRecipes.map(recipe => (
                  <div key={recipe.id} className="bg-white rounded-lg border border-gray-200 p-4 hover:shadow-lg transition-shadow">
                    <div className="flex items-start justify-between mb-3">
                      <h3 className="font-semibold text-lg text-gray-900">{recipe.name}</h3>
                      <button
                        onClick={() => toggleFavorite(recipe.id)}
                        className="text-gray-400 hover:text-red-600 transition-colors"
                      >
                        <Heart className={`w-5 h-5 ${recipe.favorite ? 'fill-current text-red-500' : ''}`} />
                      </button>
                    </div>

                    <div className="flex flex-wrap gap-2 mb-3">
                      <span className="text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-800">
                        {recipe.cuisine}
                      </span>
                      <span className={`text-xs px-2 py-1 rounded-full ${getSpiceColor(recipe.spiceLevel)}`}>
                        {recipe.spiceLevel}
                      </span>
                      <span className="text-xs px-2 py-1 rounded-full bg-purple-100 text-purple-800">
                        {recipe.difficulty}
                      </span>
                    </div>

                    <div className="space-y-2 mb-3">
                      <div className="flex items-center gap-2 text-sm text-gray-600">
                        <Star className="w-4 h-4 text-yellow-500 fill-current" />
                        <span>{recipe.rating} / 5</span>
                      </div>
                      <div className="flex items-center gap-2 text-sm text-gray-600">
                        <Clock className="w-4 h-4" />
                        <span>Cooked {recipe.timesCooked} times</span>
                      </div>
                    </div>

                    {recipe.notes && (
                      <p className="text-sm text-gray-600 mb-3 italic">&quot;{recipe.notes}&quot;</p>
                    )}

                    <div className="mb-3">
                      <p className="text-xs font-semibold text-gray-700 mb-1">Ingredients:</p>
                      <div className="flex flex-wrap gap-1">
                        {recipe.ingredients.map((ing, idx) => (
                          <span
                            key={idx}
                            className={`text-xs px-2 py-1 rounded ${
                              storeCupboard.some(item => item.toLowerCase() === ing.toLowerCase())
                                ? 'bg-green-100 text-green-800'
                                : 'bg-gray-100 text-gray-600'
                            }`}
                          >
                            {ing}
                          </span>
                        ))}
                      </div>
                    </div>

                    {selectedDay && (
                      <button
                        onClick={() => assignMealToDay(selectedDay, recipe)}
                        className="w-full py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                      >
                        Add to {selectedDay}
                      </button>
                    )}
                  </div>
                ))}
              </div>

              {filteredRecipes.length === 0 && (
                <div className="text-center py-12 text-gray-500">
                  <Book className="w-12 h-12 mx-auto mb-3 opacity-50" />
                  <p>No recipes found matching your filters</p>
                </div>
              )}
            </div>
          </div>
        )}

        {activeTab === 'cupboard' && (
          <div>
            <div className="mb-6">
              <h2 className="text-2xl font-bold text-gray-900 mb-2">Store Cupboard</h2>
              <p className="text-gray-600">Manage ingredients you already have</p>
            </div>

            <div className="grid md:grid-cols-2 gap-6">
              <div className="bg-white rounded-lg border border-gray-200 p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">Your Items</h3>
                
                <div className="flex gap-2 mb-4">
                  <input
                    type="text"
                    placeholder="Add new item..."
                    value={newStoreItem}
                    onChange={(e) => setNewStoreItem(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && addStoreCupboardItem()}
                    className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                  <button
                    onClick={addStoreCupboardItem}
                    className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                  >
                    <Plus className="w-5 h-5" />
                  </button>
                </div>

                <div className="flex flex-wrap gap-2">
                  {storeCupboard.map((item, idx) => (
                    <div
                      key={idx}
                      className="flex items-center gap-2 px-3 py-2 bg-green-100 text-green-800 rounded-lg"
                    >
                      <span>{item}</span>
                      <button
                        onClick={() => removeStoreCupboardItem(item)}
                        className="text-green-600 hover:text-green-800"
                      >
                        <X className="w-4 h-4" />
                      </button>
                    </div>
                  ))}
                </div>
              </div>

              <div className="bg-white rounded-lg border border-gray-200 p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">Suggested Recipes</h3>
                <p className="text-sm text-gray-600 mb-4">Based on your store cupboard items</p>
                
                <div className="space-y-3">
                  {getRecipesUsingStoreCupboard().slice(0, 5).map(recipe => {
                    const matchCount = recipe.ingredients.filter(ing => 
                      storeCupboard.some(item => item.toLowerCase() === ing.toLowerCase())
                    ).length;
                    
                    return (
                      <div key={recipe.id} className="p-3 border border-gray-200 rounded-lg hover:border-blue-500 transition-colors">
                        <div className="flex items-center justify-between mb-2">
                          <h4 className="font-medium text-gray-900">{recipe.name}</h4>
                          <span className="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">
                            {matchCount}/{recipe.ingredients.length} items
                          </span>
                        </div>
                        <div className="flex items-center gap-2 text-sm text-gray-600">
                          <Star className="w-4 h-4 text-yellow-500 fill-current" />
                          <span>{recipe.rating}</span>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          </div>
        )}

        {activeTab === 'analytics' && (
          <div>
            <div className="mb-6">
              <h2 className="text-2xl font-bold text-gray-900 mb-2">Meal Analytics</h2>
              <p className="text-gray-600">Track your cooking habits and favorites</p>
            </div>

            <div className="grid md:grid-cols-2 gap-6">
              <div className="bg-white rounded-lg border border-gray-200 p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                  <TrendingUp className="w-5 h-5 text-blue-600" />
                  Most Cooked Meals
                </h3>
                <div className="space-y-3">
                  {getMostCookedMeals().map((recipe, idx) => (
                    <div key={recipe.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                      <div className="flex items-center gap-3">
                        <span className="text-2xl font-bold text-gray-300">#{idx + 1}</span>
                        <div>
                          <h4 className="font-medium text-gray-900">{recipe.name}</h4>
                          <p className="text-sm text-gray-600">{recipe.cuisine}</p>
                        </div>
                      </div>
                      <span className="text-lg font-semibold text-blue-600">{recipe.timesCooked}x</span>
                    </div>
                  ))}
                </div>
              </div>

              <div className="bg-white rounded-lg border border-gray-200 p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                  <Star className="w-5 h-5 text-yellow-500 fill-current" />
                  Top Rated Meals
                </h3>
                <div className="space-y-3">
                  {getTopRatedMeals().map((recipe, idx) => (
                    <div key={recipe.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                      <div className="flex items-center gap-3">
                        <span className="text-2xl font-bold text-gray-300">#{idx + 1}</span>
                        <div>
                          <h4 className="font-medium text-gray-900">{recipe.name}</h4>
                          <p className="text-sm text-gray-600">{recipe.cuisine}</p>
                        </div>
                      </div>
                      <div className="flex items-center gap-1 text-lg font-semibold text-yellow-600">
                        <Star className="w-5 h-5 fill-current" />
                        <span>{recipe.rating}</span>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        )}
      </main>
    </div>
